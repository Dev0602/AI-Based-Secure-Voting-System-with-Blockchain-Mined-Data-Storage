{"version":3,"file":"sequence.js","names":["MAX_ITERATIONS","buildInitializationSequence","rootNode","batches","i","batch","recursivelyGetNextSequenceBatch","length","push","YError","node","nodeIsALeaf","__childNodes","nodeIsInBatches","every","childNode","concat","__name","reduce","Set","some","includes"],"sources":["../src/sequence.ts"],"sourcesContent":["import YError from 'yerror';\n\nexport type Node = {\n  __name: string;\n  __childNodes?: Node[];\n};\n\nconst MAX_ITERATIONS = 99;\n\nexport function buildInitializationSequence<T extends Node>(\n  rootNode: T,\n): string[][] {\n  const batches: string[][] = [];\n  let i = 0;\n\n  while (i < MAX_ITERATIONS) {\n    const batch = recursivelyGetNextSequenceBatch(rootNode, batches);\n\n    if (0 === batch.length) {\n      break;\n    }\n    batches.push(batch);\n    i++;\n  }\n\n  if (i === MAX_ITERATIONS) {\n    throw new YError('E_PROBABLE_CIRCULAR_DEPENDENCY');\n  }\n\n  return batches;\n}\n\nfunction recursivelyGetNextSequenceBatch(\n  node: Node,\n  batches: string[][],\n  batch: string[] = [],\n): string[] {\n  const nodeIsALeaf = !(node.__childNodes && node.__childNodes.length);\n\n  if (nodeIsInBatches(batches, node)) {\n    return batch;\n  }\n\n  if (\n    nodeIsALeaf ||\n    (node.__childNodes as Node[]).every((childNode: Node) =>\n      nodeIsInBatches(batches, childNode),\n    )\n  ) {\n    return batch.concat(node.__name);\n  }\n\n  return (node.__childNodes as Node[]).reduce(\n    (batch, childNode) => [\n      ...new Set(recursivelyGetNextSequenceBatch(childNode, batches, batch)),\n    ],\n    batch,\n  );\n}\n\nfunction nodeIsInBatches(batches: string[][], node: Node): boolean {\n  return batches.some((batch) => batch.includes(node.__name));\n}\n"],"mappings":";;;;;;;AAAA;;;;AAOA,MAAMA,cAAc,GAAG,EAAvB;;AAEO,SAASC,2BAAT,CACLC,QADK,EAEO;EACZ,MAAMC,OAAmB,GAAG,EAA5B;EACA,IAAIC,CAAC,GAAG,CAAR;;EAEA,OAAOA,CAAC,GAAGJ,cAAX,EAA2B;IACzB,MAAMK,KAAK,GAAGC,+BAA+B,CAACJ,QAAD,EAAWC,OAAX,CAA7C;;IAEA,IAAI,MAAME,KAAK,CAACE,MAAhB,EAAwB;MACtB;IACD;;IACDJ,OAAO,CAACK,IAAR,CAAaH,KAAb;IACAD,CAAC;EACF;;EAED,IAAIA,CAAC,KAAKJ,cAAV,EAA0B;IACxB,MAAM,IAAIS,eAAJ,CAAW,gCAAX,CAAN;EACD;;EAED,OAAON,OAAP;AACD;;AAED,SAASG,+BAAT,CACEI,IADF,EAEEP,OAFF,EAGEE,KAAe,GAAG,EAHpB,EAIY;EACV,MAAMM,WAAW,GAAG,EAAED,IAAI,CAACE,YAAL,IAAqBF,IAAI,CAACE,YAAL,CAAkBL,MAAzC,CAApB;;EAEA,IAAIM,eAAe,CAACV,OAAD,EAAUO,IAAV,CAAnB,EAAoC;IAClC,OAAOL,KAAP;EACD;;EAED,IACEM,WAAW,IACVD,IAAI,CAACE,YAAN,CAA8BE,KAA9B,CAAqCC,SAAD,IAClCF,eAAe,CAACV,OAAD,EAAUY,SAAV,CADjB,CAFF,EAKE;IACA,OAAOV,KAAK,CAACW,MAAN,CAAaN,IAAI,CAACO,MAAlB,CAAP;EACD;;EAED,OAAQP,IAAI,CAACE,YAAN,CAA8BM,MAA9B,CACL,CAACb,KAAD,EAAQU,SAAR,KAAsB,CACpB,GAAG,IAAII,GAAJ,CAAQb,+BAA+B,CAACS,SAAD,EAAYZ,OAAZ,EAAqBE,KAArB,CAAvC,CADiB,CADjB,EAILA,KAJK,CAAP;AAMD;;AAED,SAASQ,eAAT,CAAyBV,OAAzB,EAA8CO,IAA9C,EAAmE;EACjE,OAAOP,OAAO,CAACiB,IAAR,CAAcf,KAAD,IAAWA,KAAK,CAACgB,QAAN,CAAeX,IAAI,CAACO,MAApB,CAAxB,CAAP;AACD"}