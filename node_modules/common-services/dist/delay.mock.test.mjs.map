{"version":3,"file":"delay.mock.test.mjs","names":["assert","YError","initDelayMock","describe","test","done","then","service","create","clear","__resolve","__resolveAll","__reject","__rejectAll","catch","delayPromise","Promise","resolve","all","delayPromises","Array","fill","map","err","equal","code"],"sources":["../src/delay.mock.test.ts"],"sourcesContent":["/* eslint max-nested-callbacks:0 */\nimport assert from 'assert';\nimport YError from 'yerror';\nimport initDelayMock from './delay.mock';\n\ndescribe('initDelayMock', () => {\n  test('should work', (done) => {\n    initDelayMock({})\n      .then(\n        ({\n          service: {\n            create,\n            clear,\n            __resolve,\n            __resolveAll,\n            __reject,\n            __rejectAll,\n          },\n        }) => {\n          assert('function' === typeof create);\n          assert('function' === typeof clear);\n          assert('function' === typeof __resolve);\n          assert('function' === typeof __resolveAll);\n          assert('function' === typeof __reject);\n          assert('function' === typeof __rejectAll);\n        },\n      )\n      .then(() => done())\n      .catch(done);\n  });\n\n  describe('_resolve', () => {\n    test('should work', (done) => {\n      initDelayMock({})\n        .then(({ service: { create, __resolve } }) => {\n          const delayPromise = create(1000);\n\n          return Promise.resolve([__resolve(delayPromise), delayPromise]);\n        })\n        .then(() => done())\n        .catch(done);\n    });\n  });\n\n  describe('_resolveAll', () => {\n    test('should work with no pending delays', (done) => {\n      initDelayMock({})\n        .then(({ service: { __resolveAll } }) => __resolveAll())\n        .then(() => done())\n        .catch(done);\n    });\n\n    test('should work with one pending delay', (done) => {\n      initDelayMock({})\n        .then(({ service: { create, __resolveAll } }) => {\n          const delayPromise = create(1000);\n\n          return Promise.all([delayPromise, __resolveAll()]);\n        })\n        .then(() => done())\n        .catch(done);\n    });\n\n    test('should work with 10 pending delays', (done) => {\n      initDelayMock({})\n        .then(({ service: { create, __resolveAll } }) => {\n          const delayPromises = new Array(10).fill(1).map(() => create(1000));\n\n          return Promise.all([__resolveAll(), ...delayPromises]);\n        })\n        .then(() => done())\n        .catch(done);\n    });\n  });\n\n  describe('_reject', () => {\n    test('should work', (done) => {\n      initDelayMock({})\n        .then(({ service: { create, __reject } }) => {\n          const delayPromise = create(1000);\n\n          return Promise.all([\n            __reject(delayPromise),\n            delayPromise\n              .then(() => {\n                throw new YError('E_UNEXPECTED_SUCCESS');\n              })\n              .catch((err) => {\n                assert.equal(err.code, 'E_DELAY_CLEARED');\n              }),\n          ]);\n        })\n        .then(() => done())\n        .catch(done);\n    });\n  });\n\n  describe('_rejectAll', () => {\n    test('should work with no pending delays', (done) => {\n      initDelayMock({})\n        .then(({ service: { __rejectAll } }) => __rejectAll())\n        .then(() => done())\n        .catch(done);\n    });\n\n    test('should work with one pending delay', (done) => {\n      initDelayMock({})\n        .then(({ service: { create, __rejectAll } }) => {\n          const delayPromise = create(1000);\n\n          return Promise.all([\n            delayPromise\n              .then(() => {\n                throw new YError('E_UNEXPECTED_SUCCESS');\n              })\n              .catch((err) => {\n                assert.equal(err.code, 'E_DELAY_CLEARED');\n              }),\n            __rejectAll(),\n          ]);\n        })\n        .then(() => done())\n        .catch(done);\n    });\n\n    test('should work with 10 pending delays', (done) => {\n      initDelayMock({})\n        .then(({ service: { create, __rejectAll } }) => {\n          const delayPromises = new Array(10)\n            .fill(1)\n            .map(() => create(1000))\n            .map((delayPromise) =>\n              delayPromise\n                .then(() => {\n                  throw new YError('E_UNEXPECTED_SUCCESS');\n                })\n                .catch((err) => {\n                  assert.equal(err.code, 'E_DELAY_CLEARED');\n                }),\n            );\n\n          return Promise.all([__rejectAll(), ...delayPromises]);\n        })\n        .then(() => done())\n        .catch(done);\n    });\n  });\n});\n"],"mappings":"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"}