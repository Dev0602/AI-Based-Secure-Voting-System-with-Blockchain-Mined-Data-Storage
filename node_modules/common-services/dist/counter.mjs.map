{"version":3,"file":"counter.mjs","names":["autoService","singleton","noop","undefined","DEFAULT_COUNTER","firstCount","initCounter","COUNTER","log","currentCount","counter"],"sources":["../src/counter.ts"],"sourcesContent":["import { autoService, singleton } from 'knifecycle';\nimport type { LogService } from './log';\n\nfunction noop(): void {\n  return undefined;\n}\n\nexport interface CounterService {\n  (): Promise<number>;\n}\n\nexport type CounterServiceConfig = {\n  COUNTER?: { firstCount: number };\n};\nexport type CounterServiceDependencies = CounterServiceConfig & {\n  log?: LogService;\n};\n\nconst DEFAULT_COUNTER = {\n  firstCount: 1,\n};\n\n/* Architecture Note #1.6: Counter\n\nThe `counter` service provide a simple, local and\n stubbable counter.\n\nThe count are returned asynchronously in order\n to be easily maintained across several instances\n if needed later via another service with the same\n surface API.\n*/\n\nexport default singleton(autoService(initCounter), true);\n\n/**\n * Instantiate the counter service\n * @name initCounter\n * @function\n * @param  {Object}   services\n * The services to inject\n * @param  {Object}   [services.COUNTER=DEFAULT_COUNTER]\n * An optional configuration object\n * @param  {Object}   [services.log=noop]\n * An optional logging function\n * @return {Promise<Function>}\n * A promise of the counter function\n * @example\n * import initCounter from 'common-services/dist/counter';\n *\n * const counter = await initCounter({\n *   COUNTER: { firstCount: 1 },\n *   log: console.log.bind(console),\n * });\n */\nasync function initCounter({\n  COUNTER = DEFAULT_COUNTER,\n  log = noop,\n}: CounterServiceDependencies): Promise<CounterService> {\n  let currentCount = COUNTER.firstCount;\n\n  log('debug', 'ðŸ“‡ - Counter service initialized.');\n\n  return counter;\n\n  /**\n   * Returns the current count and increment the counter\n   * @return {Promise<number>}\n   * A promise of the current count\n   * @example\n   * console.log([\n   *   counter(),\n   *   counter(),\n   *   counter(),\n   * ]);\n   * // Prints: 1,2,3\n   */\n  async function counter() {\n    log('debug', 'ðŸ“‡ - Picked a count:', currentCount);\n    return currentCount++;\n  }\n}\n"],"mappings":"AAAA,SAASA,OAAW,IAAXA,QAAT,EAAsBC,SAAtB,QAAuC,YAAvC;;AAGA,SAASC,IAAT,GAAsB;EACpB,OAAOC,SAAP;AACD;;AAaD,MAAMC,eAAe,GAAG;EACtBC,UAAU,EAAE;AADU,CAAxB;AAeA,eAAeJ,SAAS,CAACD,QAAW,CAACM,WAAD,kCAAZ,EAA2B,IAA3B,CAAxB;;AAsBA,eAAeA,WAAf,CAA2B;EACzBC,OAAO,GAAGH,eADe;EAEzBI,GAAG,GAAGN;AAFmB,CAA3B,EAGwD;EACtD,IAAIO,YAAY,GAAGF,OAAO,CAACF,UAA3B;EAEAG,GAAG,CAAC,OAAD,EAAU,mCAAV,CAAH;EAEA,OAAOE,OAAP;;EAcA,eAAeA,OAAf,GAAyB;IACvBF,GAAG,CAAC,OAAD,EAAU,sBAAV,EAAkCC,YAAlC,CAAH;IACA,OAAOA,YAAY,EAAnB;EACD;AACF"}